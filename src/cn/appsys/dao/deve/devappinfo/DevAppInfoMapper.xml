<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.appsys.dao.deve.devappinfo.DevAppInfoMapper">
    <!-- 分页查询 -->
    <select id="queryAppPageInfo" resultType="AppInfo">
          SELECT a.`softwareName`,a.`APKName`,a.`softwareSize`, 
			(SELECT valueName FROM data_dictionary WHERE typecode = 'APP_FLATFORM' AND valueid = a.`flatformId`) flatFormName, a.`flatformId`,
			(SELECT categoryName FROM `app_category` WHERE id = a.`categoryLevel1`) categoryName1,a.`categoryLevel1`,
			(SELECT categoryName FROM `app_category` WHERE id = a.`categoryLevel2`) categoryName2,a.`categoryLevel2`,
			(SELECT categoryName FROM `app_category` WHERE id = a.`categoryLevel3`) categoryName3,a.`categoryLevel3`,
			(SELECT valueName FROM data_dictionary WHERE typecode = 'APP_STATUS' AND valueId = a.`status`) statusName,
			a.`status`,a.`downloads`,(SELECT versionNo FROM `app_version` WHERE id = a.`versionId`) versionNo,a.`versionId` 
			FROM `app_info` a
			<where>
			      <if test="softwareName != null and softwareName != ''">
			          and a.`softwareName` CONCAT('%',#{querySoftwareName},'%') 
			      </if>
			       <if test="queryStatus != null and queryStatus != 0">
			          and a.`status = #{queryStatus}
			      </if>
			       <if test="queryFlatformId != null and queryFlatformId != 0">
			          and a.`flatformId` CONCAT('%',#{queryFlatformId},'%') 
			      </if>
			       <if test="queryCategoryLevel1 != null and queryCategoryLevel1 != 0">
			          and a.`categoryLevel1` = #{queryCategoryLevel1}
			      </if>
			       <if test="queryCategoryLevel2 != null and queryCategoryLevel2 != 0">
			          and a.`categoryLevel2` = #{queryCategoryLevel2}
			      </if>
			       <if test="queryCategoryLevel3 != null and queryCategoryLevel3 != 0">
			          and a.`categoryLevel3` = #{queryCategoryLevel3}
			      </if>
			</where>
			ORDER BY creationDate DESC
			LIMIT #{from},#{pageSize}
    </select>
    
    <!-- 查询多少条记录 -->
    <select id="queryCount" resultType="int">
           select count(1) app_info
           <where>
			      <if test="softwareName != null and softwareName != ''">
			          and a.`softwareName` CONCAT('%',#{querySoftwareName},'%') 
			      </if>
			       <if test="queryStatus != null and queryStatus != 0">
			          and a.`status = #{queryStatus}
			      </if>
			       <if test="queryFlatformId != null and queryFlatformId != 0">
			          and a.`flatformId` CONCAT('%',#{queryFlatformId},'%') 
			      </if>
			       <if test="queryCategoryLevel1 != null and queryCategoryLevel1 != 0">
			          and a.`categoryLevel1` = #{queryCategoryLevel1}
			      </if>
			       <if test="queryCategoryLevel2 != null and queryCategoryLevel2 != 0">
			          and a.`categoryLevel2` = #{queryCategoryLevel2}
			      </if>
			       <if test="queryCategoryLevel3 != null and queryCategoryLevel3 != 0">
			          and a.`categoryLevel3` = #{queryCategoryLevel3}
			      </if>
			</where>
    </select>
</mapper>